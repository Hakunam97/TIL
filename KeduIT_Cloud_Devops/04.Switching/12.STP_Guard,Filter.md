STP Root Switch 보호
---

### 1. Root Guard

현재 구성되어 있는 topology에서 더 낮은 BPDU 값을 가진 Switch가 추가로 연결되면 포트를 Blocking 상태로 변경시켜서 해당 포트는 사용 불가능

- 전역환경설정에서는 아직 지원하지 않음

- 개별 Interface에서 설정
- 주로 End device가 연결되는 Access port에 설정을 주로 함

```
(config-if) spanning-tree guard root
```


#### 실습

![](images/2023-08-08-13-36-28.png)

> 현재 SW1이 Root Switch
> SW4의 BPDU 값이 SW1보다 낮다고 가정하자

1. SW2에 Root guard 설정   
  ```
  SW2(config)# int e3/3
  SW2(config-if)# spanning-tree guard root
  ```

2. SW4를 SW2 e3/3 Interface에 추가적으로 연결   

![](images/2023-08-08-13-38-22.png)   

1. 확인

![](images/2023-08-08-13-38-39.png)   
> Root guard로 인해 e3/3 Interface가 blocking 상태로 되었다는 메시지 확인   

  ![](images/2023-08-08-13-39-11.png)   
  * SW2의 e3/3 Interface에서 BPDU를 수신하지 않음 (Block)
  * 만약 SW4의 Priority가 SW1보다 값이 낮지 않으면 Root Guard는 작동하지 않음



### 2. BPDU Guard

BPDU가 해당 포트로 수신되면 해당 포트를 err-disabled (shutdown)으로 변경해서 사용불가 포트로 변경시킨다. (차단)

- 주로 End-Device와 연결되는 Access port에 설정을 주로 함
- 전역 환경설정과 개별 Interface 설정 둘 다 가능

#### 전역환경설정
```
(config)# spanning-tree portfast bpduguard default

(config-if)# spanning-tree portfast
```
- 전역 환경설정에서 BPDU Guard를 설정하는 경우 Switch와 Swich 사이의 BPDU를 전송하지 못하기 때문에 **Interface에 portfast 기능이 설정된 Interface에서만 작동**


#### 개별 Interface 설정
```
(config-if)# spanning-tree bpduguard enable
```

- err-disabled로 인해 shutdown이 된 Interface는 관리자가 **shutdown** 명령어를 입력하면 해당 Interface의 상태를 초기화 (err-disabled 풀림) ---> no shutdown ---> Active




BPDU Filter
---

- Switch는 Listening port부터 BPDU를 전송하기 시작함
- 