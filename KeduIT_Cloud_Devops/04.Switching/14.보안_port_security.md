Switch 보안설정
===

Error disable 
---

> 스위치에서 발생할 수 있는 error를 스위치에서 내장된 감지 기능을 이용하여 처리하는 방식으로 스위치 제조사에서 해당 process를 넣어야 작동 가능

- 모든 스위치가 동일한 error를 관리하지 않음
- 저가의 스위치보다 고가의 스위치가 더 많은 error를 관리하고 프로토콜에 대응할 수 있도록 지원한다.


#### (1) 스위치에서 지원하는 error disable process 확인

```
# show errdisable detect
```

![](images/2023-08-31-20-25-30.png)

- **flap** : 연결/연결해제 를 일정 시간 동안 반복하는 error
- **arp-inspection** : ARP 취약점을 이용한 MIMA(중간자 공격) 약간 방어하는 기술 ---> CISCO DAI (Dynamic Arp Inspection)
  - 관리자가 trust / untrust 를 설정(정의)
  - untrust로 설정된 인터페이스에서 통신 되는 packet을 확인하여 옳지 않은 MAC-IP packet을 log로 남기고 폐기
  - Trust 된 인터페이스는 packet을 그대로 통과
  
  ```md
  (config)# ip arp inspection vlan [VLAN ID]
	(config)# interface [인터페이스 이름] [ID]

  # 신뢰하지 않는 인터페이스에 초당 ARP packet 수(pps : packet per seconds)를 조절해서 해당 숫자를 넘어가면 차단
  (config-if)# ip arp inspection limit rate [숫자]

  # trunk port, gateway 장비가 연결된 곳, 관리자가 관리를 하는 서버 등에 설정하는 것이 좋음
  (config-if)# ip arp inspection trust 
  ```
  - DAI 설정된 포트 확인
  
  ```
  # show ip arp inspection interfaces
  ```

  ![](images/2023-08-31-20-27-58.png)

  - DAI 관련 통계 정보
  ```
  # show ip arp inspection statistics
  ```

- **DHCP Snooping**
  - DHCP 서버를 보호하기 위한 기능으로 DHCP Spoofing(속이다)를 방어하기 위해 스위치가 DHCP 메시지를 확인하는 기능
  - dhcp-rate-limit
  - DHCP 응답을 차단시키는 기능을 통해 DHCP 서버 보호
  - DHCP 서버 포트는 Trust, 나머지 포트는 Untrust로 설정 (ip arp inspection 기능과 작동 방식이 비슷)
  
  ```md
  (config)# ip dhcp snooping
  (config)# ip dhcp snooping vlan [VLAN ID]
  (config)# no ip dhcp snooping information option (DHCP option 82 : 가입자인증 관련 옵션)
  (config)# interface [인터페이스 이름] [ID]
  (config-if)# ip dhcp snooping limit rate 15
  (config-if)# ip dhcp snooping trust

  # trunk port, DHCP reply를 하는 포트에 설정하는 것이 좋음
  ```

  확인 명령어   
  ```
  # show ip dhcp snooping
				
  # show ip dhcp snooping statistics
  ```

- **gbic-invalid**
  - CISCO gbic만 사용하도록 하는 기능 (gbic : 광케이블연결 인터페이스 ---> STP)


#### (2) err-disable된 포트를 활성화